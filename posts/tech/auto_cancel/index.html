<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>auto-cancel | Patrick's Blog</title><meta name=keywords content><meta name=description content="ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚ ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ ç”Ÿæˆè®¢å•6"><meta name=author content="
ä½œè€…:&nbsp;Patrick"><link rel=canonical href=https://www.fangw.online/blog/posts/tech/auto_cancel/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.dd1b6faf624e5755c15f8dcbebe3baddf132af6fccc93770550b6804e12de142.css integrity="sha256-3Rtvr2JOV1XBX43L6+O63fEyr2/MyTdwVQtoBOEt4UI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.fangw.online/blog/img/Q.png><link rel=icon type=image/png sizes=16x16 href=https://www.fangw.online/blog/img/Q.png><link rel=icon type=image/png sizes=32x32 href=https://www.fangw.online/blog/img/Q.png><link rel=apple-touch-icon href=https://www.fangw.online/blog/Q.png><link rel=mask-icon href=https://www.fangw.online/blog/Q.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="auto-cancel"><meta property="og:description" content="ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚ ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ ç”Ÿæˆè®¢å•6"><meta property="og:type" content="article"><meta property="og:url" content="https://www.fangw.online/blog/posts/tech/auto_cancel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-05T00:17:58+08:00"><meta property="article:modified_time" content="2022-05-05T00:17:58+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="auto-cancel"><meta name=twitter:description content="ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚ ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ ç”Ÿæˆè®¢å•6"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://www.fangw.online/blog/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://www.fangw.online/blog/posts/tech/"},{"@type":"ListItem","position":3,"name":"auto-cancel","item":"https://www.fangw.online/blog/posts/tech/auto_cancel/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"auto-cancel","name":"auto-cancel","description":"ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚ ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ ç”Ÿæˆè®¢å•6","keywords":[""],"articleBody":"ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚\nç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ ç”Ÿæˆè®¢å•60ç§’å,ç»™ç”¨æˆ·å‘çŸ­ä¿¡ å¯¹ä¸Šè¿°çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ç»™ä¸€ä¸ªä¸“ä¸šçš„åå­—æ¥å½¢å®¹ï¼Œé‚£å°±æ˜¯å»¶æ—¶ä»»åŠ¡ã€‚é‚£ä¹ˆè¿™é‡Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå»¶æ—¶ä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡çš„åŒºåˆ«ç©¶ç«Ÿåœ¨å“ªé‡Œå‘¢ï¼Ÿä¸€å…±æœ‰å¦‚ä¸‹å‡ ç‚¹åŒºåˆ«\nå®šæ—¶ä»»åŠ¡æœ‰æ˜ç¡®çš„è§¦å‘æ—¶é—´ï¼Œå»¶æ—¶ä»»åŠ¡æ²¡æœ‰ å®šæ—¶ä»»åŠ¡æœ‰æ‰§è¡Œå‘¨æœŸï¼Œè€Œå»¶æ—¶ä»»åŠ¡åœ¨æŸäº‹ä»¶è§¦å‘åä¸€æ®µæ—¶é—´å†…æ‰§è¡Œï¼Œæ²¡æœ‰æ‰§è¡Œå‘¨æœŸ å®šæ—¶ä»»åŠ¡ä¸€èˆ¬æ‰§è¡Œçš„æ˜¯æ‰¹å¤„ç†æ“ä½œæ˜¯å¤šä¸ªä»»åŠ¡ï¼Œè€Œå»¶æ—¶ä»»åŠ¡ä¸€èˆ¬æ˜¯å•ä¸ªä»»åŠ¡ ä¸€èˆ¬å®ç°çš„æ–¹æ³•æœ‰å‡ ç§ï¼š\nä½¿ç”¨ rocketmqã€rabbitmqã€pulsar ç­‰æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶æŠ•é€’åŠŸèƒ½ ä½¿ç”¨ redisson æä¾›çš„ DelayedQueue æœ‰ä¸€äº›æ–¹æ¡ˆè™½ç„¶å¹¿ä¸ºæµä¼ ä½†å­˜åœ¨ç€è‡´å‘½ç¼ºé™·ï¼Œä¸è¦ç”¨æ¥å®ç°å»¶æ—¶ä»»åŠ¡\nä½¿ç”¨ redis çš„è¿‡æœŸç›‘å¬ ä½¿ç”¨ rabbitmq çš„æ­»ä¿¡é˜Ÿåˆ— ä½¿ç”¨éæŒä¹…åŒ–çš„æ—¶é—´è½® æ•°æ®åº“è½®è¯¢ ğŸ‘ æ•°æ®é‡ï¼Œå¹¶å‘é‡å¹¶ä¸å¤§çš„ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆã€‚\nè¯¥æ–¹æ¡ˆé€šå¸¸æ˜¯åœ¨å°å‹é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå³é€šè¿‡ä¸€ä¸ªçº¿ç¨‹å®šæ—¶çš„å»æ‰«ææ•°æ®åº“ï¼Œé€šè¿‡è®¢å•æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æœ‰è¶…æ—¶çš„è®¢å•ï¼Œç„¶åè¿›è¡Œupdateæˆ–deleteç­‰æ“ä½œã€‚\nä¼˜ç‚¹: ç®€å•æ˜“è¡Œï¼Œæ”¯æŒé›†ç¾¤æ“ä½œ ç¼ºç‚¹: (1)å¯¹æœåŠ¡å™¨å†…å­˜æ¶ˆè€—å¤§ (2)å­˜åœ¨å»¶è¿Ÿï¼Œæ¯”å¦‚ä½ æ¯éš”3åˆ†é’Ÿæ‰«æä¸€æ¬¡ï¼Œé‚£æœ€åçš„å»¶è¿Ÿæ—¶é—´å°±æ˜¯3åˆ†é’Ÿ (3)å‡è®¾ä½ çš„è®¢å•æœ‰å‡ åƒä¸‡æ¡ï¼Œæ¯éš”å‡ åˆ†é’Ÿè¿™æ ·æ‰«æä¸€æ¬¡ï¼Œæ•°æ®åº“æŸè€—æå¤§ JDKçš„å»¶è¿Ÿé˜Ÿåˆ— ğŸ™Š è¯¥æ–¹æ¡ˆæ˜¯åˆ©ç”¨JDKè‡ªå¸¦çš„DelayQueueæ¥å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡çš„æ—¶å€™æ‰èƒ½ä»ä¸­è·å–å…ƒç´ ï¼Œæ”¾å…¥DelayQueueä¸­çš„å¯¹è±¡ï¼Œæ˜¯å¿…é¡»å®ç°Delayedæ¥å£çš„ã€‚\nä¼˜ç‚¹: æ•ˆç‡é«˜,ä»»åŠ¡è§¦å‘æ—¶é—´å»¶è¿Ÿä½ã€‚ ç¼ºç‚¹: (1)æœåŠ¡å™¨é‡å¯åï¼Œæ•°æ®å…¨éƒ¨æ¶ˆå¤±ï¼Œæ€•å®•æœº (2)é›†ç¾¤æ‰©å±•ç›¸å½“éº»çƒ¦ (3)å› ä¸ºå†…å­˜æ¡ä»¶é™åˆ¶çš„åŸå› ï¼Œæ¯”å¦‚ä¸‹å•æœªä»˜æ¬¾çš„è®¢å•æ•°å¤ªå¤šï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å°±å‡ºç°OOMå¼‚å¸¸ (4)ä»£ç å¤æ‚åº¦è¾ƒé«˜ æ—¶é—´è½®ç®—æ³• ğŸ™Š æ—¶é—´è½®æ˜¯ä¸€ç§å¾ˆä¼˜ç§€çš„å®šæ—¶ä»»åŠ¡çš„æ•°æ®ç»“æ„ï¼Œç„¶è€Œç»å¤§å¤šæ•°æ—¶é—´è½®å®ç°æ˜¯çº¯å†…å­˜æ²¡æœ‰æŒä¹…åŒ–çš„ã€‚\nredisç¼“å­˜è¿‡æœŸç›‘å¬ ğŸ™Š Redis å®˜æ–¹æ‰‹å†Œçš„keyspace-notifications: timing-of-expired-eventsä¸­æ˜ç¡®æŒ‡å‡ºï¼š\nBasically expired events are generated when the Redis server deletes the key and not when the time to live theoretically reaches the value of zero\nredis è‡ªåŠ¨è¿‡æœŸçš„å®ç°æ–¹å¼æ˜¯ï¼šå®šæ—¶ä»»åŠ¡ç¦»çº¿æ‰«æå¹¶åˆ é™¤éƒ¨åˆ†è¿‡æœŸé”®ï¼›åœ¨è®¿é—®é”®æ—¶æƒ°æ€§æ£€æŸ¥æ˜¯å¦è¿‡æœŸå¹¶åˆ é™¤è¿‡æœŸé”®ã€‚redis ä»æœªä¿è¯ä¼šåœ¨è®¾å®šçš„è¿‡æœŸæ—¶é—´ç«‹å³åˆ é™¤å¹¶å‘é€è¿‡æœŸé€šçŸ¥ã€‚å®é™…ä¸Šï¼Œè¿‡æœŸé€šçŸ¥æ™šäºè®¾å®šçš„è¿‡æœŸæ—¶é—´æ•°åˆ†é’Ÿçš„æƒ…å†µä¹Ÿæ¯”è¾ƒå¸¸è§ã€‚\næ­¤å¤–é”®ç©ºé—´é€šçŸ¥é‡‡ç”¨çš„æ˜¯å‘é€å³å¿˜(fire and forget)ç­–ç•¥ï¼Œå¹¶ä¸åƒæ¶ˆæ¯é˜Ÿåˆ—ä¸€æ ·ä¿è¯é€è¾¾ã€‚å½“è®¢é˜…äº‹ä»¶çš„å®¢æˆ·ç«¯ä¼šä¸¢å¤±æ‰€æœ‰åœ¨æ–­çº¿æœŸé—´æ‰€æœ‰åˆ†å‘ç»™å®ƒçš„äº‹ä»¶ã€‚\nRedission RDelayedQueue redisson delayqueue æ˜¯ä¸€ç§åŸºäº redis zset ç»“æ„çš„å»¶æ—¶é˜Ÿåˆ—å®ç°ã€‚delayqueue ä¸­æœ‰ä¸€ä¸ªåä¸º timeoutSetName çš„æœ‰åºé›†åˆï¼Œå…¶ä¸­å…ƒç´ çš„ score ä¸ºæŠ•é€’æ—¶é—´æˆ³ã€‚delayqueue ä¼šå®šæ—¶ä½¿ç”¨ zrangebyscore æ‰«æå·²åˆ°æŠ•é€’æ—¶é—´çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠå®ƒä»¬ç§»åŠ¨åˆ°å°±ç»ªæ¶ˆæ¯åˆ—è¡¨ä¸­ã€‚\ndelayqueue ä¿è¯ redis ä¸å´©æºƒçš„æƒ…å†µä¸‹ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œåœ¨æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ—¶ä¸å¦¨ä¸€è¯•ã€‚\nåœ¨æ•°æ®åº“ç´¢å¼•è®¾è®¡è‰¯å¥½çš„æƒ…å†µä¸‹ï¼Œå®šæ—¶æ‰«ææ•°æ®åº“ä¸­æœªå®Œæˆçš„è®¢å•äº§ç”Ÿçš„å¼€é”€å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå¤§ã€‚åœ¨ä½¿ç”¨ redisson delayqueue ç­‰å®šæ—¶ä»»åŠ¡ä¸­é—´ä»¶æ—¶å¯ä»¥åŒæ—¶ä½¿ç”¨æ‰«ææ•°æ®åº“çš„æ–¹æ³•ä½œä¸ºè¡¥å¿æœºåˆ¶ï¼Œé¿å…ä¸­é—´ä»¶æ•…éšœé€ æˆä»»åŠ¡ä¸¢å¤±ã€‚\nåŸºäº Redis å®ç°å»¶è¿Ÿé˜Ÿåˆ—\næ¶ˆæ¯é˜Ÿåˆ— ğŸ‘ ä¼˜ç‚¹: é«˜æ•ˆ,å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ†å¸ƒå¼ç‰¹æ€§è½»æ˜“çš„è¿›è¡Œæ¨ªå‘æ‰©å±•,æ¶ˆæ¯æ”¯æŒæŒä¹…åŒ–å¢åŠ äº†å¯é æ€§ã€‚ ç¼ºç‚¹ï¼šä¾èµ–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¤æ‚åº¦å’Œæˆæœ¬å˜é«˜ RocketMQ å®ç° Kafka å®ç° ","wordCount":"1389","inLanguage":"en","datePublished":"2022-05-05T00:17:58+08:00","dateModified":"2022-05-05T00:17:58+08:00","author":[{"@type":"Person","name":"Patrick"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.fangw.online/blog/posts/tech/auto_cancel/"},"publisher":{"@type":"Organization","name":"Patrick's Blog","logo":{"@type":"ImageObject","url":"https://www.fangw.online/blog/img/Q.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><script async src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><header class=header><nav class=nav><div class=logo><a href=https://www.fangw.online/blog/ accesskey=h title="Patrick's Blog (Alt + H)"><img src=https://www.fangw.online/blog/img/Q.png alt=logo aria-label=logo height=30>Patrick's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.fangw.online/blog/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://www.fangw.online/blog/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://www.fangw.online/blog/posts title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://www.fangw.online/blog/archives/ title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://www.fangw.online/blog/tags title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://www.fangw.online/blog/about title=ğŸ™‹ğŸ»â€â™‚ï¸å…³äº><span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.fangw.online/blog/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.fangw.online/blog/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://www.fangw.online/blog/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>auto-cancel</h1><div class=post-meta>åˆ›å»º:&nbsp;<span title='2022-05-05 00:17:58 +0800 +0800'>2022-05-05</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2022-05-05&nbsp;|&nbsp;å­—æ•°:&nbsp;1389å­—&nbsp;|&nbsp;æ—¶é•¿:&nbsp;3åˆ†é’Ÿ&nbsp;|&nbsp;
ä½œè€…:&nbsp;Patrick
&nbsp;|&nbsp;æ ‡ç­¾: &nbsp;<ul class=post-tags-meta><a href=https://www.fangw.online/blog/tags/tech/>tech</a></ul><span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>æ–‡ç« ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e7%94%9f%e6%88%90%e8%ae%a2%e5%8d%9530%e5%88%86%e9%92%9f%e6%9c%aa%e6%94%af%e4%bb%98%e5%88%99%e8%87%aa%e5%8a%a8%e5%8f%96%e6%b6%88%e8%af%a5%e6%80%8e%e4%b9%88%e5%ae%9e%e7%8e%b0 aria-label=ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ>ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bd%ae%e8%af%a2- aria-label="æ•°æ®åº“è½®è¯¢ ğŸ‘">æ•°æ®åº“è½®è¯¢ ğŸ‘</a></li><li><a href=#jdk%e7%9a%84%e5%bb%b6%e8%bf%9f%e9%98%9f%e5%88%97- aria-label="JDKçš„å»¶è¿Ÿé˜Ÿåˆ— ğŸ™Š">JDKçš„å»¶è¿Ÿé˜Ÿåˆ— ğŸ™Š</a></li><li><a href=#%e6%97%b6%e9%97%b4%e8%bd%ae%e7%ae%97%e6%b3%95- aria-label="æ—¶é—´è½®ç®—æ³• ğŸ™Š">æ—¶é—´è½®ç®—æ³• ğŸ™Š</a></li><li><a href=#redis%e7%bc%93%e5%ad%98%e8%bf%87%e6%9c%9f%e7%9b%91%e5%90%ac- aria-label="redisç¼“å­˜è¿‡æœŸç›‘å¬ ğŸ™Š">redisç¼“å­˜è¿‡æœŸç›‘å¬ ğŸ™Š</a></li><li><a href=#redission-rdelayedqueue aria-label="Redission RDelayedQueue">Redission RDelayedQueue</a></li><li><a href=#%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97- aria-label="æ¶ˆæ¯é˜Ÿåˆ— ğŸ‘">æ¶ˆæ¯é˜Ÿåˆ— ğŸ‘</a><ul><li><a href=#rocketmq-%e5%ae%9e%e7%8e%b0 aria-label="RocketMQ å®ç°">RocketMQ å®ç°</a></li><li><a href=#kafka-%e5%ae%9e%e7%8e%b0 aria-label="Kafka å®ç°">Kafka å®ç°</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆè¯¥æ€ä¹ˆå®ç°>ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆè¯¥æ€ä¹ˆå®ç°>#</a></h1><p>åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚</p><ul><li>ç”Ÿæˆè®¢å•<code>30</code>åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ</li><li>ç”Ÿæˆè®¢å•<code>60</code>ç§’å,ç»™ç”¨æˆ·å‘çŸ­ä¿¡</li></ul><p>å¯¹ä¸Šè¿°çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ç»™ä¸€ä¸ªä¸“ä¸šçš„åå­—æ¥å½¢å®¹ï¼Œé‚£å°±æ˜¯å»¶æ—¶ä»»åŠ¡ã€‚é‚£ä¹ˆè¿™é‡Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå»¶æ—¶ä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡çš„åŒºåˆ«ç©¶ç«Ÿåœ¨å“ªé‡Œå‘¢ï¼Ÿä¸€å…±æœ‰å¦‚ä¸‹å‡ ç‚¹åŒºåˆ«</p><ul><li>å®šæ—¶ä»»åŠ¡æœ‰æ˜ç¡®çš„è§¦å‘æ—¶é—´ï¼Œå»¶æ—¶ä»»åŠ¡æ²¡æœ‰</li><li>å®šæ—¶ä»»åŠ¡æœ‰æ‰§è¡Œå‘¨æœŸï¼Œè€Œå»¶æ—¶ä»»åŠ¡åœ¨æŸäº‹ä»¶è§¦å‘åä¸€æ®µæ—¶é—´å†…æ‰§è¡Œï¼Œæ²¡æœ‰æ‰§è¡Œå‘¨æœŸ</li><li>å®šæ—¶ä»»åŠ¡ä¸€èˆ¬æ‰§è¡Œçš„æ˜¯æ‰¹å¤„ç†æ“ä½œæ˜¯å¤šä¸ªä»»åŠ¡ï¼Œè€Œå»¶æ—¶ä»»åŠ¡ä¸€èˆ¬æ˜¯å•ä¸ªä»»åŠ¡</li></ul><p>ä¸€èˆ¬å®ç°çš„æ–¹æ³•æœ‰å‡ ç§ï¼š</p><ul><li>ä½¿ç”¨ rocketmqã€rabbitmqã€pulsar ç­‰æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶æŠ•é€’åŠŸèƒ½</li><li>ä½¿ç”¨ redisson æä¾›çš„ DelayedQueue</li></ul><p>æœ‰ä¸€äº›æ–¹æ¡ˆè™½ç„¶å¹¿ä¸ºæµä¼ ä½†å­˜åœ¨ç€è‡´å‘½ç¼ºé™·ï¼Œ<strong>ä¸è¦ç”¨æ¥å®ç°å»¶æ—¶ä»»åŠ¡</strong></p><ul><li>ä½¿ç”¨ redis çš„è¿‡æœŸç›‘å¬</li><li>ä½¿ç”¨ rabbitmq çš„æ­»ä¿¡é˜Ÿåˆ—</li><li>ä½¿ç”¨éæŒä¹…åŒ–çš„æ—¶é—´è½®</li></ul><h2 id=æ•°æ®åº“è½®è¯¢->æ•°æ®åº“è½®è¯¢ ğŸ‘<a hidden class=anchor aria-hidden=true href=#æ•°æ®åº“è½®è¯¢->#</a></h2><blockquote><p>æ•°æ®é‡ï¼Œå¹¶å‘é‡å¹¶ä¸å¤§çš„ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆã€‚</p></blockquote><p>è¯¥æ–¹æ¡ˆé€šå¸¸æ˜¯åœ¨å°å‹é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå³é€šè¿‡ä¸€ä¸ªçº¿ç¨‹å®šæ—¶çš„å»æ‰«ææ•°æ®åº“ï¼Œé€šè¿‡è®¢å•æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æœ‰è¶…æ—¶çš„è®¢å•ï¼Œç„¶åè¿›è¡Œ<code>update</code>æˆ–<code>delete</code>ç­‰æ“ä½œã€‚</p><ul><li>ä¼˜ç‚¹: ç®€å•æ˜“è¡Œï¼Œæ”¯æŒé›†ç¾¤æ“ä½œ</li><li>ç¼ºç‚¹:<ul><li>(1)å¯¹æœåŠ¡å™¨å†…å­˜æ¶ˆè€—å¤§</li><li>(2)å­˜åœ¨å»¶è¿Ÿï¼Œæ¯”å¦‚ä½ æ¯éš”3åˆ†é’Ÿæ‰«æä¸€æ¬¡ï¼Œé‚£æœ€åçš„å»¶è¿Ÿæ—¶é—´å°±æ˜¯<code>3</code>åˆ†é’Ÿ</li><li>(3)å‡è®¾ä½ çš„è®¢å•æœ‰å‡ åƒä¸‡æ¡ï¼Œæ¯éš”å‡ åˆ†é’Ÿè¿™æ ·æ‰«æä¸€æ¬¡ï¼Œæ•°æ®åº“æŸè€—æå¤§</li></ul></li></ul><h2 id=jdkçš„å»¶è¿Ÿé˜Ÿåˆ—->JDKçš„å»¶è¿Ÿé˜Ÿåˆ— ğŸ™Š<a hidden class=anchor aria-hidden=true href=#jdkçš„å»¶è¿Ÿé˜Ÿåˆ—->#</a></h2><p>è¯¥æ–¹æ¡ˆæ˜¯åˆ©ç”¨<code>JDK</code>è‡ªå¸¦çš„<code>DelayQueue</code>æ¥å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡çš„æ—¶å€™æ‰èƒ½ä»ä¸­è·å–å…ƒç´ ï¼Œæ”¾å…¥<code>DelayQueue</code>ä¸­çš„å¯¹è±¡ï¼Œæ˜¯å¿…é¡»å®ç°<code>Delayed</code>æ¥å£çš„ã€‚</p><ul><li>ä¼˜ç‚¹: æ•ˆç‡é«˜,ä»»åŠ¡è§¦å‘æ—¶é—´å»¶è¿Ÿä½ã€‚<ul><li>ç¼ºç‚¹:</li><li>(1)æœåŠ¡å™¨é‡å¯åï¼Œæ•°æ®å…¨éƒ¨æ¶ˆå¤±ï¼Œæ€•å®•æœº</li><li>(2)é›†ç¾¤æ‰©å±•ç›¸å½“éº»çƒ¦</li><li>(3)å› ä¸ºå†…å­˜æ¡ä»¶é™åˆ¶çš„åŸå› ï¼Œæ¯”å¦‚ä¸‹å•æœªä»˜æ¬¾çš„è®¢å•æ•°å¤ªå¤šï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å°±å‡ºç°OOMå¼‚å¸¸</li><li>(4)ä»£ç å¤æ‚åº¦è¾ƒé«˜</li></ul></li></ul><h2 id=æ—¶é—´è½®ç®—æ³•->æ—¶é—´è½®ç®—æ³• ğŸ™Š<a hidden class=anchor aria-hidden=true href=#æ—¶é—´è½®ç®—æ³•->#</a></h2><p>æ—¶é—´è½®æ˜¯ä¸€ç§å¾ˆä¼˜ç§€çš„å®šæ—¶ä»»åŠ¡çš„æ•°æ®ç»“æ„ï¼Œç„¶è€Œç»å¤§å¤šæ•°æ—¶é—´è½®å®ç°æ˜¯çº¯å†…å­˜æ²¡æœ‰æŒä¹…åŒ–çš„ã€‚</p><h2 id=redisç¼“å­˜è¿‡æœŸç›‘å¬->redisç¼“å­˜è¿‡æœŸç›‘å¬ ğŸ™Š<a hidden class=anchor aria-hidden=true href=#redisç¼“å­˜è¿‡æœŸç›‘å¬->#</a></h2><p>Redis å®˜æ–¹æ‰‹å†Œçš„keyspace-notifications: timing-of-expired-eventsä¸­æ˜ç¡®æŒ‡å‡ºï¼š</p><blockquote><p>Basically expired events are generated when the Redis server deletes the key and not when the time to live theoretically reaches the value of zero</p></blockquote><p><code>redis</code> è‡ªåŠ¨è¿‡æœŸçš„å®ç°æ–¹å¼æ˜¯ï¼šå®šæ—¶ä»»åŠ¡ç¦»çº¿æ‰«æå¹¶åˆ é™¤éƒ¨åˆ†è¿‡æœŸé”®ï¼›åœ¨è®¿é—®é”®æ—¶æƒ°æ€§æ£€æŸ¥æ˜¯å¦è¿‡æœŸå¹¶åˆ é™¤è¿‡æœŸé”®ã€‚<code>redis</code> ä»æœªä¿è¯ä¼šåœ¨è®¾å®šçš„è¿‡æœŸæ—¶é—´ç«‹å³åˆ é™¤å¹¶å‘é€è¿‡æœŸé€šçŸ¥ã€‚å®é™…ä¸Šï¼Œè¿‡æœŸé€šçŸ¥æ™šäºè®¾å®šçš„è¿‡æœŸæ—¶é—´æ•°åˆ†é’Ÿçš„æƒ…å†µä¹Ÿæ¯”è¾ƒå¸¸è§ã€‚</p><p>æ­¤å¤–é”®ç©ºé—´é€šçŸ¥é‡‡ç”¨çš„æ˜¯å‘é€å³å¿˜(fire and forget)ç­–ç•¥ï¼Œå¹¶ä¸åƒæ¶ˆæ¯é˜Ÿåˆ—ä¸€æ ·ä¿è¯é€è¾¾ã€‚å½“è®¢é˜…äº‹ä»¶çš„å®¢æˆ·ç«¯ä¼šä¸¢å¤±æ‰€æœ‰åœ¨æ–­çº¿æœŸé—´æ‰€æœ‰åˆ†å‘ç»™å®ƒçš„äº‹ä»¶ã€‚</p><h2 id=redission-rdelayedqueue>Redission RDelayedQueue<a hidden class=anchor aria-hidden=true href=#redission-rdelayedqueue>#</a></h2><p>redisson delayqueue æ˜¯ä¸€ç§åŸºäº redis zset ç»“æ„çš„å»¶æ—¶é˜Ÿåˆ—å®ç°ã€‚delayqueue ä¸­æœ‰ä¸€ä¸ªåä¸º timeoutSetName çš„æœ‰åºé›†åˆï¼Œå…¶ä¸­å…ƒç´ çš„ score ä¸ºæŠ•é€’æ—¶é—´æˆ³ã€‚delayqueue ä¼šå®šæ—¶ä½¿ç”¨ zrangebyscore æ‰«æå·²åˆ°æŠ•é€’æ—¶é—´çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠå®ƒä»¬ç§»åŠ¨åˆ°å°±ç»ªæ¶ˆæ¯åˆ—è¡¨ä¸­ã€‚</p><p>delayqueue ä¿è¯ redis ä¸å´©æºƒçš„æƒ…å†µä¸‹ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œåœ¨æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ—¶ä¸å¦¨ä¸€è¯•ã€‚</p><p>åœ¨æ•°æ®åº“ç´¢å¼•è®¾è®¡è‰¯å¥½çš„æƒ…å†µä¸‹ï¼Œå®šæ—¶æ‰«ææ•°æ®åº“ä¸­æœªå®Œæˆçš„è®¢å•äº§ç”Ÿçš„å¼€é”€å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå¤§ã€‚åœ¨ä½¿ç”¨ redisson delayqueue ç­‰å®šæ—¶ä»»åŠ¡ä¸­é—´ä»¶æ—¶å¯ä»¥åŒæ—¶ä½¿ç”¨æ‰«ææ•°æ®åº“çš„æ–¹æ³•ä½œä¸ºè¡¥å¿æœºåˆ¶ï¼Œé¿å…ä¸­é—´ä»¶æ•…éšœé€ æˆä»»åŠ¡ä¸¢å¤±ã€‚</p><p><a href=../redis/delay-queue>åŸºäº Redis å®ç°å»¶è¿Ÿé˜Ÿåˆ—</a></p><h2 id=æ¶ˆæ¯é˜Ÿåˆ—->æ¶ˆæ¯é˜Ÿåˆ— ğŸ‘<a hidden class=anchor aria-hidden=true href=#æ¶ˆæ¯é˜Ÿåˆ—->#</a></h2><ul><li>ä¼˜ç‚¹: é«˜æ•ˆ,å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ†å¸ƒå¼ç‰¹æ€§è½»æ˜“çš„è¿›è¡Œæ¨ªå‘æ‰©å±•,æ¶ˆæ¯æ”¯æŒæŒä¹…åŒ–å¢åŠ äº†å¯é æ€§ã€‚</li><li>ç¼ºç‚¹ï¼šä¾èµ–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¤æ‚åº¦å’Œæˆæœ¬å˜é«˜</li></ul><h3 id=rocketmq-å®ç°>RocketMQ å®ç°<a hidden class=anchor aria-hidden=true href=#rocketmq-å®ç°>#</a></h3><h3 id=kafka-å®ç°>Kafka å®ç°<a hidden class=anchor aria-hidden=true href=#kafka-å®ç°>#</a></h3></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.fangw.online/blog/posts/read/read/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Read</span></a>
<a class=next href=https://www.fangw.online/blog/posts/tech/tech/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Tech</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.4.11/twikoo.all.min.js></script><script>twikoo.init({envId:"",el:"#tcomment",lang:"zh-CN",region:"ap-guangzhou",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><script async src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
2020-2022
<a href=https://www.fangw.online/blog/ style=color:#939393>Patrick's Blog</a>
All Rights Reserved</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393>æ²ªICPå¤‡20014522å·</a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393>æ²ªICPå¤‡20014522å·-1</a></span>
<span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>æ€»è®¿å®¢æ•°: <span id=busuanzi_value_site_uv></span>
æ€»è®¿é—®é‡: <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒPatrick's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒPatrick's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="ğŸ“„å¤åˆ¶";function s(){t.innerText="ğŸ‘ŒğŸ»å·²å¤åˆ¶!",setTimeout(()=>{t.innerText="ğŸ“„å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒPatrick's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>