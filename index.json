[{"content":"åˆ†ç»„æŸ¥è¯¢æ¯ç»„ä»·æ ¼æœ€é«˜çš„ä¸¤ä¸ªå…ƒç´ æœ‰æ•ˆå…ƒç´  å»ºè¡¨è¯­å¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 DROP TABLE IF EXISTS `mygoods`; CREATE TABLE `mygoods` ( `goods_id` int(11) unsigned NOT NULL AUTO_INCREMENT, `cat_id` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39;, `price` tinyint(3) NOT NULL DEFAULT \u0026#39;0\u0026#39;, `status` tinyint(3) DEFAULT \u0026#39;1\u0026#39;, PRIMARY KEY (`goods_id`), KEY `icatid` (`cat_id`) ) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of mygoods -- ---------------------------- BEGIN; INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (1, 101, 90, 0); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (2, 101, 99, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (3, 102, 98, 0); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (4, 103, 96, 0); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (5, 102, 95, 0); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (6, 102, 94, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (7, 102, 93, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (8, 103, 99, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (9, 103, 98, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (10, 103, 97, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (11, 104, 96, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (12, 104, 95, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (13, 104, 94, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (15, 101, 92, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (16, 101, 93, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (17, 101, 99, 0); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (18, 102, 99, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (19, 105, 85, 1); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (20, 105, 89, 0); INSERT INTO `mygoods` (`goods_id`, `cat_id`, `price`, `status`) VALUES (21, 105, 99, 1); COMMIT; SET FOREIGN_KEY_CHECKS = 1; 1. å’Œè‡ªå·±æ¯”è¾ƒ å¾ªç¯æŸ¥å‡ºæ¯ç»„å¤§äºå½“å‰ä»·æ ¼çš„æ•°é‡ ç„¶åå–å‰ä¸¤ä¸ªã€‚æœ€åæ’åº 1 2 3 SELECT a.* FROM mygoods a WHERE ( SELECT count( 1 ) FROM mygoods WHERE cat_id = a.cat_id AND price \u0026gt; a.price ) \u0026lt; 2 ORDER BY a.cat_id,a.price DESC; 2. è®¾ç½®å˜é‡ å…ˆæ’åº å†ç”¨å‡½æ•°ç»™æ•°æ®æ ‡è¡Œå· æœ€åå–å°äº2çš„è¡Œ 1 2 3 4 5 set @row_num:=0; set @pre_cat_id =\u0026#39;\u0026#39;; select * FROM ( select goods_id, cat_id, price,if(@pre_cat_id=cat_id,@row_num:=@row_num+1,@row_num:=0) as rownum,@pre_cat_id :=cat_id from mygoods where status =1 order by cat_id,price desc) as t where rownum\u0026lt;2 3. mysql 8 æ”¯æŒ ROW_NUMBER() over PARTITION by 1 select goods_id, cat_id, price,ROW_NUMBER() over(partition by cat_id order by price desc) mm from mygoods \u0026mdash; ä»¥ä¸Šä¸‰ç§æ–¹å¼æœ‰ä¸ªé—®é¢˜ï¼Œ å¦‚æœå‡ºç°å¹¶æ’çš„åˆ™å–å€¼ä¼šé—æ¼å…¶ä»–ç›¸åŒé¡¹\n4. mysql8è¿˜æä¾›äº†rank()å’Œdense_rank()å‡½æ•°ã€‚ 1 2 3 4 -- rank-è·³è·ƒæ’åºï¼Œå‡ºç°å¹¶åˆ—åä¼šå ç”¨åç»­èŠ‚ç‚¹ï¼›å¦‚ ä¸¤ä¸ªå¹¶åˆ—ç¬¬ä¸€ é‚£ä¼šç›´æ¥è·³åˆ°ç¬¬ä¸‰åæ’åœ¨åé¢ ç¬¬äºŒåä¼šä¸¢å¤±ã€‚ select goods_id, cat_id, price,rank() over(partition by cat_id order by price desc) tp from mygoods where tp\u0026lt;2 -- dense_rank-è¿ç»­æ’åº å¹¶åˆ—æƒ…å†µä¸‹ ä¸ä¼šå ç”¨åç»­èŠ‚ç‚¹ ã€‚å¦‚ ä¸¤ä¸ªå¹¶åˆ—ç¬¬ä¸€ é‚£ç¬¬äºŒåä¼šç´§è·Ÿå…¶åã€‚ select goods_id, cat_id, price,dense_rank() over(partition by cat_id order by price desc) tp from mygoods where tp\u0026lt;2 5. é’ˆå¯¹ç¬¬2ç§çš„ä¼˜åŒ–æ–¹æ¡ˆ 1 2 3 4 5 6 set @row_num:=0; set @pre_cat_id =\u0026#39;\u0026#39;; set @pre_price=0; select * FROM ( select goods_id, cat_id, price,if(@pre_cat_id=cat_id, if(@pre_price=price,@row_num,@row_num:=@row_num+1),@row_num:=0) as rownum,@pre_cat_id :=cat_id,@pre_price :=price from mygoods order by cat_id,price desc) as t where rownum\u0026lt;2 ","permalink":"https://www.fangw.online/posts/tech/mysql/group_top/","summary":"åˆ†ç»„æŸ¥è¯¢æ¯ç»„ä»·æ ¼æœ€é«˜çš„ä¸¤ä¸ªå…ƒç´ æœ‰æ•ˆå…ƒç´  å»ºè¡¨è¯­å¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 DROP TABLE IF EXISTS `mygoods`; CREATE TABLE `mygoods` ( `goods_id`","title":"åˆ†ç»„æŸ¥è¯¢æ¯ç»„ä»·æ ¼æœ€é«˜çš„ä¸¤ä¸ªå…ƒç´ æœ‰æ•ˆå…ƒç´ "},{"content":"Zetæ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹zsetæœ‰å¤šå°‘æ•°æ® ZCARD homemarket:realTimeTrans # è¾“å‡ºzsetæ•°æ®è¯¦æƒ… ZRANGE homemarket:realTimeTrans 0 -1 withscores # ç§»é™¤æŒ‡å®šå…ƒç´  ZREMRANGEBYRANK homemarket:realTimeTrans 3 3 # ç§»é™¤æ‰€æœ‰å…ƒç´  ZREMRANGEBYRANK homemarket:realTimeTrans 0 -1 # å¢åŠ å…ƒç´ ï¼Œ éœ€è¦ç”¨åŒå¼•å·å¯ä»¥é¿å…ä¸­æ–‡ååºåˆ—åŒ–é—®é¢˜ã€‚æ—¶é—´-8å°æ—¶ ZADD homemarket:realTimeTrans 1718789470278 \u0026#34;{\\\u0026#34;@class\\\u0026#34;:\\\u0026#34;xxx$TransVO\\\u0026#34;,\\\u0026#34;type\\\u0026#34;:\\\u0026#34;facPolicy\\\u0026#34;,\\\u0026#34;transNo\\\u0026#34;:\\\u0026#34;xx000000003\\\u0026#34;,\\\u0026#34;transDate\\\u0026#34;:[\\\u0026#34;java.util.Date\\\u0026#34;,\\\u0026#34;2024-06-12T11:00:08.257+00:00\\\u0026#34;],\\\u0026#34;iconZh\\\u0026#34;:\\\u0026#34;2024\\x88\\x86\\\u0026#34;,\\\u0026#34;iconEn\\\u0026#34;:\\\u0026#34;2024Policy\\\u0026#34;,\\\u0026#34;premium\\\u0026#34;:\\\u0026#34;xxx\\\u0026#34;}\u0026#34; å‚è€ƒï¼šèœé¸Ÿæ•™ç¨‹\n","permalink":"https://www.fangw.online/posts/tech/redis/redis-zset-cli/","summary":"Zetæ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹zsetæœ‰å¤šå°‘æ•°æ® ZCARD homemarket:realTimeTrans # è¾“å‡ºzsetæ•°æ®è¯¦æƒ… ZRANGE homemarket:realTimeTrans 0 -1 withscores # ç§»é™¤æŒ‡å®šå…ƒç´  ZREMRANGEBYRANK homemarket:realTimeTrans 3 3 # ç§»é™¤æ‰€æœ‰å…ƒç´  ZREMRANGEBYRANK","title":"Redis Zsetæ“ä½œ"},{"content":"MAC 14.2.1 åˆ·æ–°dns 1 sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder è®¾ç½®dns 1 networksetup -setdnsservers Wi-Fi 140.205.81.23 8.8.8.8 114.114.114.114 ","permalink":"https://www.fangw.online/posts/tech/common_tools/","summary":"MAC 14.2.1 åˆ·æ–°dns 1 sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder è®¾ç½®dns 1 networksetup -setdnsservers Wi-Fi 140.205.81.23 8.8.8.8 114.114.114.114","title":"å¸¸ç”¨å·¥å…·è„šæœ¬"},{"content":"åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç° èƒŒæ™¯ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“æŸä¸ªèµ„æºå¯ä»¥è¢«å¤šä¸ªç³»ç»Ÿè®¿é—®ä½¿ç”¨åˆ°çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯å¤§å®¶è®¿é—®è¿™ä¸ªæ•°æ®æ˜¯ä¸€è‡´æ€§çš„ï¼Œé‚£ä¹ˆå°±è¦æ±‚å†åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½è¢«ä¸€ä¸ªç³»ç»Ÿä½¿ç”¨ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ†å¸ƒå¼é”ã€‚\nåˆ†å¸ƒå¼å’Œé›†ç¾¤çš„åŒºåˆ« å®šä¹‰çš„åŒºåˆ«\nè®¡ç®—æœºé›†ç¾¤ï¼ˆè‹±è¯­ï¼šcomputer clusterï¼‰æ˜¯ä¸€ç»„æ¾æ•£æˆ–ç´§å¯†è¿æ¥åœ¨ä¸€èµ·å·¥ä½œçš„è®¡ç®—æœºã€‚ç”±äºè¿™äº›è®¡ç®—æœºååŒå·¥ä½œï¼Œåœ¨è®¸å¤šæ–¹é¢å®ƒä»¬å¯ä»¥è¢«è§†ä¸ºå•ä¸ªç³»ç»Ÿã€‚ä¸ç½‘æ ¼è®¡ç®—æœºä¸åŒï¼Œè®¡ç®—æœºé›†ç¾¤å°†æ¯ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸ºæ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œç”±è½¯ä»¶æ§åˆ¶å’Œè°ƒåº¦ã€‚\nç»´åŸºç™¾ç§‘çš„è§£é‡Šï¼Œå…³é”®è¯æ˜¯ï¼šä¸€ç»„è®¡ç®—æœºã€ç›¸åŒçš„ä»»åŠ¡ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸€ç»„ç”µè„‘ï¼Œé€è¿‡ç½‘ç»œç›¸äº’è¿æ¥ä¼ é€’æ¶ˆæ¯ä¸é€šä¿¡åå¹¶åè°ƒå®ƒä»¬çš„è¡Œä¸ºè€Œå½¢æˆçš„ç³»ç»Ÿã€‚[1]ç»„ä»¶ä¹‹é—´å½¼æ­¤è¿›è¡Œäº¤äº’ä»¥å®ç°ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ã€‚æŠŠéœ€è¦è¿›è¡Œå¤§é‡è®¡ç®—çš„å·¥ç¨‹æ•°æ®åˆ†å‰²æˆå°å—ï¼Œç”±å¤šå°è®¡ç®—æœºåˆ†åˆ«è®¡ç®—ï¼Œå†ä¸Šä¼ è¿ç®—ç»“æœåï¼Œå°†ç»“æœç»Ÿä¸€åˆå¹¶å¾—å‡ºæ•°æ®ç»“è®ºçš„ç§‘å­¦ã€‚\nç»´åŸºç™¾ç§‘çš„è§£é‡Šï¼Œå…³é”®è¯æ˜¯ï¼šä¸€ç»„è®¡ç®—æœºã€å¤§è®¡ç®—åˆ†è§£\né›†ç¾¤çš„å…³é”®ä½œç”¨æ˜¯æå‡å¹¶å‘å¤„ç†èƒ½åŠ› åˆ†å¸ƒå¼çš„å…³é”®ä½œç”¨æ˜¯è§£è€¦ä»¥ä¾¿äºå¿«é€Ÿè¿­ä»£ åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡å“ªäº›æ¡ä»¶ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªæœºå™¨çš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ é«˜å¯ç”¨çš„è·å–é”ä¸é‡Šæ”¾é” é«˜æ€§èƒ½çš„è·å–é”ä¸é‡Šæ”¾é” å…·å¤‡å¯é‡å…¥ç‰¹æ€§ å…·å¤‡é”å¤±æ•ˆæœºåˆ¶ï¼Œé˜²æ­¢æ­»é” å…·å¤‡éé˜»å¡é”ç‰¹æ€§ï¼Œå³æ²¡æœ‰è·å–åˆ°é”å°†ç›´æ¥è¿”å›è·å–é”å¤±è´¥ å®ç° å®šä¹‰æ¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 /** * åˆ†å¸ƒå¼é”é¡¶çº§æ¥å£ * * @author : fangwei * @date : 2019/9/23 0:48 */ public interface DistributedLock { /** * è·å–é” * * @param key KEY * @throws Exception å¼‚å¸¸ */ void acquire(String key) throws Exception; /** * è·å–é” * * @param key KEY * @param maxWait æœ€å¤§ç­‰å¾…æ—¶é—´ * @param waitUnit ç­‰å¾…æ—¶é—´å•ä½ * @return æˆåŠŸ/å¤±è´¥ * @throws Exception å¼‚å¸¸ */ boolean acquire(String key, long maxWait, TimeUnit waitUnit) throws Exception; /** * é‡Šæ”¾é” * * @param key KEY * @throws Exception å¼‚å¸¸ */ void release(String key) throws Exception; } ZooKeeper åˆ†å¸ƒå¼é”å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 /** * Distributed Lock http://curator.apache.org//getting-started.html * * @author : fangwei * @date : 2020/5/29 15:02 */ public class ZkDistributedLock implements DistributedLock { private final CuratorFramework client; public ZkDistributedLock(CuratorFramework client) { this.client = client; } @Override public void acquire(String key) throws Exception { InterProcessMutex lock = new InterProcessMutex(client, key); lock.acquire(); } @Override public boolean acquire(String key, long maxWait, TimeUnit waitUnit) throws Exception { InterProcessMutex lock = new InterProcessMutex(client, key); return lock.acquire(maxWait, waitUnit); } @Override public void release(String key) throws Exception { InterProcessMutex lock = new InterProcessMutex(client, key); lock.release(); } } å®šä¹‰CuratorFramework 1 2 3 4 5 6 7 8 9 10 11 12 /** * initMethod start ç›¸å½“äºæ‰§è¡Œ client.start() * * @return CuratorFramework */ @Bean(initMethod = \u0026#34;start\u0026#34;) @ConditionalOnMissingBean public CuratorFramework curatorFramework(CuratorProperties curatorProperties) { RetryPolicy retryPolicy = new ExponentialBackoffRetry(curatorProperties.getBaseSleepTimeMs(), curatorProperties.getMaxRetries()); return CuratorFrameworkFactory.newClient(curatorProperties.getZookeeperConnectionString(), retryPolicy); } 1 2 3 4 5 6 7 8 9 10 11 12 13 /** * zk curator é…ç½® * * @author : fangwei * @date : 2020/1/22 9:18 */ @Data @ConfigurationProperties(prefix = \u0026#34;curator\u0026#34;) public class CuratorProperties { private int baseSleepTimeMs = 1000; private int maxRetries = 3; private String zookeeperConnectionString; } Redisson åˆ†å¸ƒå¼é”å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 /** * Redisson åˆ†å¸ƒå¼Ré” - å¯é‡å…¥é” * * @author : fangwei * @date : 2020/4/28 10:30 */ public class RedissonDistributedRLock implements DistributedLock { private final RedissonClient redissonClient; public RedissonDistributedRLock(RedissonClient redissonClient) { this.redissonClient = redissonClient; } @Override public void acquire(String key) { // å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰ RLock lock = redissonClient.getLock(key); lock.lock(); } @Override public boolean acquire(String key, long maxWait, TimeUnit waitUnit) throws Exception { // å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰ RLock lock = redissonClient.getLock(key); return lock.tryLock(maxWait, waitUnit); } @Override public void release(String key) { // å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰ RLock lock = redissonClient.getLock(key); lock.unlock(); } } ä½¿ç”¨ç¤ºä¾‹ å±æ€§è®¾ç½® 1 2 3 curator.zookeeper-connection-string = zké“¾æ¥åœ°å€ curator.base-sleep-time-ms = 1000 curator.max-retries = 3 æ³¨å…¥bean 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Autowired private CuratorFramework client; @Bean public DistributedLock distributedLock() { return new ZkDistributedLock(client); } // æˆ–è€…ä½¿ç”¨Redisson @Autowired private RedissonClient redissonClient; @Bean public DistributedLock distributedLock() { return new RedissonDistributedRLock(redissonClient); } Recipes 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Autowired private DistributedLock lock; if ( lock.acquire(maxWait, waitUnit) ) { try { // do some work inside of the critical section here } finally { lock.release(); } } æ€»ç»“ å¦‚æœåæœŸç”¨æˆ·éœ€è¦åˆ‡æ¢åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œåªéœ€è¦è°ƒæ•´ä¾èµ–çš„beançš„æ³¨å…¥å³å¯ å¸¸è§é—®é¢˜ ä½¿ç”¨Redissonåˆ†å¸ƒå¼é”æ—¶ï¼Œå‡ºç° unlock å¼‚å¸¸ å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š\n1 attempt to unlock lock, not locked by current thread by node id: 84ed3ba0-f34c-4ffd-afbf-882e775f6cd è§£å†³åŠæ³•: åœ¨è§£é”ä¹‹å‰ï¼Œåˆ¤æ–­å½“å‰keyå¯¹åº”çš„é”æ˜¯å¦å·²è¢«é”å®šå¹¶ä¸”æ˜¯å¦è¢«å½“å‰çº¿ç¨‹ä¿æŒï¼Œä»£ç å¦‚ä¸‹ï¼š\n1 2 3 if (lock.isLocked() \u0026amp;\u0026amp; lock.isHeldByCurrentThread()) { lock.unlock(); } ","permalink":"https://www.fangw.online/posts/tech/distributed-lock/","summary":"åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç° èƒŒæ™¯ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“æŸä¸ªèµ„æºå¯ä»¥è¢«å¤šä¸ªç³»ç»Ÿè®¿é—®ä½¿ç”¨åˆ°çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯å¤§å®¶è®¿é—®è¿™ä¸ªæ•°æ®æ˜¯ä¸€è‡´æ€§çš„ï¼Œé‚£ä¹ˆå°±è¦æ±‚å†åŒä¸€ä¸ªæ—¶åˆ»ï¼Œ","title":"åˆ†å¸ƒå¼é”"},{"content":"","permalink":"https://www.fangw.online/posts/blog/blog/","summary":"","title":"Blog"},{"content":"","permalink":"https://www.fangw.online/posts/life/life/","summary":"","title":"Life"},{"content":"","permalink":"https://www.fangw.online/posts/read/read/","summary":"","title":"Read"},{"content":"For test\n","permalink":"https://www.fangw.online/posts/tech/tech/","summary":"For test","title":"Tech"},{"content":"ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚\nç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ ç”Ÿæˆè®¢å•60ç§’å,ç»™ç”¨æˆ·å‘çŸ­ä¿¡ å¯¹ä¸Šè¿°çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ç»™ä¸€ä¸ªä¸“ä¸šçš„åå­—æ¥å½¢å®¹ï¼Œé‚£å°±æ˜¯å»¶æ—¶ä»»åŠ¡ã€‚é‚£ä¹ˆè¿™é‡Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå»¶æ—¶ä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡çš„åŒºåˆ«ç©¶ç«Ÿåœ¨å“ªé‡Œå‘¢ï¼Ÿä¸€å…±æœ‰å¦‚ä¸‹å‡ ç‚¹åŒºåˆ«\nå®šæ—¶ä»»åŠ¡æœ‰æ˜ç¡®çš„è§¦å‘æ—¶é—´ï¼Œå»¶æ—¶ä»»åŠ¡æ²¡æœ‰ å®šæ—¶ä»»åŠ¡æœ‰æ‰§è¡Œå‘¨æœŸï¼Œè€Œå»¶æ—¶ä»»åŠ¡åœ¨æŸäº‹ä»¶è§¦å‘åä¸€æ®µæ—¶é—´å†…æ‰§è¡Œï¼Œæ²¡æœ‰æ‰§è¡Œå‘¨æœŸ å®šæ—¶ä»»åŠ¡ä¸€èˆ¬æ‰§è¡Œçš„æ˜¯æ‰¹å¤„ç†æ“ä½œæ˜¯å¤šä¸ªä»»åŠ¡ï¼Œè€Œå»¶æ—¶ä»»åŠ¡ä¸€èˆ¬æ˜¯å•ä¸ªä»»åŠ¡ ä¸€èˆ¬å®ç°çš„æ–¹æ³•æœ‰å‡ ç§ï¼š\nä½¿ç”¨ rocketmqã€rabbitmqã€pulsar ç­‰æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶æŠ•é€’åŠŸèƒ½ ä½¿ç”¨ redisson æä¾›çš„ DelayedQueue æœ‰ä¸€äº›æ–¹æ¡ˆè™½ç„¶å¹¿ä¸ºæµä¼ ä½†å­˜åœ¨ç€è‡´å‘½ç¼ºé™·ï¼Œä¸è¦ç”¨æ¥å®ç°å»¶æ—¶ä»»åŠ¡\nä½¿ç”¨ redis çš„è¿‡æœŸç›‘å¬ ä½¿ç”¨ rabbitmq çš„æ­»ä¿¡é˜Ÿåˆ— ä½¿ç”¨éæŒä¹…åŒ–çš„æ—¶é—´è½® æ•°æ®åº“è½®è¯¢ ğŸ‘ æ•°æ®é‡ï¼Œå¹¶å‘é‡å¹¶ä¸å¤§çš„ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆã€‚\nè¯¥æ–¹æ¡ˆé€šå¸¸æ˜¯åœ¨å°å‹é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå³é€šè¿‡ä¸€ä¸ªçº¿ç¨‹å®šæ—¶çš„å»æ‰«ææ•°æ®åº“ï¼Œé€šè¿‡è®¢å•æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æœ‰è¶…æ—¶çš„è®¢å•ï¼Œç„¶åè¿›è¡Œupdateæˆ–deleteç­‰æ“ä½œã€‚\nä¼˜ç‚¹: ç®€å•æ˜“è¡Œï¼Œæ”¯æŒé›†ç¾¤æ“ä½œ ç¼ºç‚¹: (1)å¯¹æœåŠ¡å™¨å†…å­˜æ¶ˆè€—å¤§ (2)å­˜åœ¨å»¶è¿Ÿï¼Œæ¯”å¦‚ä½ æ¯éš”3åˆ†é’Ÿæ‰«æä¸€æ¬¡ï¼Œé‚£æœ€åçš„å»¶è¿Ÿæ—¶é—´å°±æ˜¯3åˆ†é’Ÿ (3)å‡è®¾ä½ çš„è®¢å•æœ‰å‡ åƒä¸‡æ¡ï¼Œæ¯éš”å‡ åˆ†é’Ÿè¿™æ ·æ‰«æä¸€æ¬¡ï¼Œæ•°æ®åº“æŸè€—æå¤§ JDKçš„å»¶è¿Ÿé˜Ÿåˆ— ğŸ™Š è¯¥æ–¹æ¡ˆæ˜¯åˆ©ç”¨JDKè‡ªå¸¦çš„DelayQueueæ¥å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡çš„æ—¶å€™æ‰èƒ½ä»ä¸­è·å–å…ƒç´ ï¼Œæ”¾å…¥DelayQueueä¸­çš„å¯¹è±¡ï¼Œæ˜¯å¿…é¡»å®ç°Delayedæ¥å£çš„ã€‚\nä¼˜ç‚¹: æ•ˆç‡é«˜,ä»»åŠ¡è§¦å‘æ—¶é—´å»¶è¿Ÿä½ã€‚ ç¼ºç‚¹: (1)æœåŠ¡å™¨é‡å¯åï¼Œæ•°æ®å…¨éƒ¨æ¶ˆå¤±ï¼Œæ€•å®•æœº (2)é›†ç¾¤æ‰©å±•ç›¸å½“éº»çƒ¦ (3)å› ä¸ºå†…å­˜æ¡ä»¶é™åˆ¶çš„åŸå› ï¼Œæ¯”å¦‚ä¸‹å•æœªä»˜æ¬¾çš„è®¢å•æ•°å¤ªå¤šï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å°±å‡ºç°OOMå¼‚å¸¸ (4)ä»£ç å¤æ‚åº¦è¾ƒé«˜ æ—¶é—´è½®ç®—æ³• ğŸ™Š æ—¶é—´è½®æ˜¯ä¸€ç§å¾ˆä¼˜ç§€çš„å®šæ—¶ä»»åŠ¡çš„æ•°æ®ç»“æ„ï¼Œç„¶è€Œç»å¤§å¤šæ•°æ—¶é—´è½®å®ç°æ˜¯çº¯å†…å­˜æ²¡æœ‰æŒä¹…åŒ–çš„ã€‚\nredisç¼“å­˜è¿‡æœŸç›‘å¬ ğŸ™Š Redis å®˜æ–¹æ‰‹å†Œçš„keyspace-notifications: timing-of-expired-eventsä¸­æ˜ç¡®æŒ‡å‡ºï¼š\nBasically expired events are generated when the Redis server deletes the key and not when the time to live theoretically reaches the value of zero\nredis è‡ªåŠ¨è¿‡æœŸçš„å®ç°æ–¹å¼æ˜¯ï¼šå®šæ—¶ä»»åŠ¡ç¦»çº¿æ‰«æå¹¶åˆ é™¤éƒ¨åˆ†è¿‡æœŸé”®ï¼›åœ¨è®¿é—®é”®æ—¶æƒ°æ€§æ£€æŸ¥æ˜¯å¦è¿‡æœŸå¹¶åˆ é™¤è¿‡æœŸé”®ã€‚redis ä»æœªä¿è¯ä¼šåœ¨è®¾å®šçš„è¿‡æœŸæ—¶é—´ç«‹å³åˆ é™¤å¹¶å‘é€è¿‡æœŸé€šçŸ¥ã€‚å®é™…ä¸Šï¼Œè¿‡æœŸé€šçŸ¥æ™šäºè®¾å®šçš„è¿‡æœŸæ—¶é—´æ•°åˆ†é’Ÿçš„æƒ…å†µä¹Ÿæ¯”è¾ƒå¸¸è§ã€‚\næ­¤å¤–é”®ç©ºé—´é€šçŸ¥é‡‡ç”¨çš„æ˜¯å‘é€å³å¿˜(fire and forget)ç­–ç•¥ï¼Œå¹¶ä¸åƒæ¶ˆæ¯é˜Ÿåˆ—ä¸€æ ·ä¿è¯é€è¾¾ã€‚å½“è®¢é˜…äº‹ä»¶çš„å®¢æˆ·ç«¯ä¼šä¸¢å¤±æ‰€æœ‰åœ¨æ–­çº¿æœŸé—´æ‰€æœ‰åˆ†å‘ç»™å®ƒçš„äº‹ä»¶ã€‚\nRedission RDelayedQueue redisson delayqueue æ˜¯ä¸€ç§åŸºäº redis zset ç»“æ„çš„å»¶æ—¶é˜Ÿåˆ—å®ç°ã€‚delayqueue ä¸­æœ‰ä¸€ä¸ªåä¸º timeoutSetName çš„æœ‰åºé›†åˆï¼Œå…¶ä¸­å…ƒç´ çš„ score ä¸ºæŠ•é€’æ—¶é—´æˆ³ã€‚delayqueue ä¼šå®šæ—¶ä½¿ç”¨ zrangebyscore æ‰«æå·²åˆ°æŠ•é€’æ—¶é—´çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠå®ƒä»¬ç§»åŠ¨åˆ°å°±ç»ªæ¶ˆæ¯åˆ—è¡¨ä¸­ã€‚\ndelayqueue ä¿è¯ redis ä¸å´©æºƒçš„æƒ…å†µä¸‹ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œåœ¨æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ—¶ä¸å¦¨ä¸€è¯•ã€‚\nåœ¨æ•°æ®åº“ç´¢å¼•è®¾è®¡è‰¯å¥½çš„æƒ…å†µä¸‹ï¼Œå®šæ—¶æ‰«ææ•°æ®åº“ä¸­æœªå®Œæˆçš„è®¢å•äº§ç”Ÿçš„å¼€é”€å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå¤§ã€‚åœ¨ä½¿ç”¨ redisson delayqueue ç­‰å®šæ—¶ä»»åŠ¡ä¸­é—´ä»¶æ—¶å¯ä»¥åŒæ—¶ä½¿ç”¨æ‰«ææ•°æ®åº“çš„æ–¹æ³•ä½œä¸ºè¡¥å¿æœºåˆ¶ï¼Œé¿å…ä¸­é—´ä»¶æ•…éšœé€ æˆä»»åŠ¡ä¸¢å¤±ã€‚\nåŸºäº Redis å®ç°å»¶è¿Ÿé˜Ÿåˆ—\næ¶ˆæ¯é˜Ÿåˆ— ğŸ‘ ä¼˜ç‚¹: é«˜æ•ˆ,å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ†å¸ƒå¼ç‰¹æ€§è½»æ˜“çš„è¿›è¡Œæ¨ªå‘æ‰©å±•,æ¶ˆæ¯æ”¯æŒæŒä¹…åŒ–å¢åŠ äº†å¯é æ€§ã€‚ ç¼ºç‚¹ï¼šä¾èµ–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¤æ‚åº¦å’Œæˆæœ¬å˜é«˜ RocketMQ å®ç° Kafka å®ç° ","permalink":"https://www.fangw.online/posts/tech/auto_cancel/","summary":"ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ åœ¨å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€äº›å…³äºå»¶æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ä¾‹å¦‚ ç”Ÿæˆè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ ç”Ÿæˆè®¢å•6","title":"è®¢å•è‡ªåŠ¨å–æ¶ˆ"},{"content":" Patrick\u0026#39;s Blog ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾æ ¼å¼ åç§°ï¼š Patrick\u0026rsquo;s Blog ç½‘å€ï¼š http://www.fangw.online å›¾æ ‡ï¼š img/Q.png æè¿°ï¼š ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾ç”³è¯·è¦æ±‚ ç§‰æ‰¿äº’æ¢å‹é“¾åŸåˆ™ã€æ–‡ç« å®šæœŸæ›´æ–°ã€ä¸èƒ½æœ‰å¤ªå¤šå¹¿å‘Šã€ä¸ªäººæè¿°å­—æ•°æ§åˆ¶åœ¨15å­—å†…\n","permalink":"https://www.fangw.online/links/","summary":"Patrick\u0026#39;s Blog ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾æ ¼å¼ åç§°ï¼š Patrick\u0026rsquo;s Blog ç½‘å€ï¼š http://www.fangw.online å›¾æ ‡ï¼š img/Q.png æè¿°ï¼š ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾ç”³è¯·è¦æ±‚ ç§‰æ‰¿äº’æ¢å‹é“¾åŸåˆ™ã€æ–‡","title":"ğŸ¤å‹é“¾"},{"content":"å…³äºæˆ‘\nè‹±æ–‡å: Patrick èŒä¸š: ç¨‹åºå‘˜ è¿åŠ¨: è·‘æ­¥ã€ä¹’ä¹“çƒã€LOL ","permalink":"https://www.fangw.online/about/","summary":"å…³äºæˆ‘ è‹±æ–‡å: Patrick èŒä¸š: ç¨‹åºå‘˜ è¿åŠ¨: è·‘æ­¥ã€ä¹’ä¹“çƒã€LOL","title":"ğŸ™‹ğŸ»â€â™‚ï¸å…³äº"},{"content":"for test\n","permalink":"https://www.fangw.online/posts/read/mysql/","summary":"for test","title":""}]